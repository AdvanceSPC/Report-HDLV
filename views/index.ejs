<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Llamadas</title>
    <link rel="stylesheet" href="/assets/css/custom-styles.css" />
    <link rel="stylesheet" href="/assets/css/styles.min.css" />
    <link
      rel="shortcut icon"
      href="/assets/images/favicon.png"
      type="image/x-icon"
    />
    <script defer src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    ></script>
  </head>
  <body class="bg-light">
    <div class="container mt-4">
      <div class="card p-4 shadow-sm">
        <h2 class="mb-3 text-center">Gestión de Llamadas</h2>
        <div class="card p-3 mb-3 bg-light">
          <form method="GET" action="/" class="d-flex gap-2 align-items-center">
            <label for="fechaDesde" class="fw-bold">Desde:</label>
            <input
              type="date"
              id="fechaDesde"
              name="fechaDesde"
              class="form-control"
              value="<%= fechaDesde || '' %>"
              required
            />
            <label for="fechaHasta" class="fw-bold">Hasta:</label>
            <input
              type="date"
              id="fechaHasta"
              name="fechaHasta"
              class="form-control"
              value="<%= fechaHasta || '' %>"
            />
            <button type="submit" class="btn btn-primary">Filtrar</button>

            <div class="dropdown ms-auto">
              <button
                class="btn btn-secondary dropdown-toggle"
                type="button"
                id="dropdownMenuButton"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                ⋮
              </button>
              <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                <li>
                  <a
                    class="dropdown-item"
                    href="/export/csv?<%= 'fechaDesde=' + (fechaDesde || '') + '&fechaHasta=' + (fechaHasta || '') %>"
                    >Descargar CSV</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    href="/export/excel?<%= 'fechaDesde=' + (fechaDesde || '') + '&fechaHasta=' + (fechaHasta || '') %>"
                    >Descargar Excel</a
                  >
                </li>
              </ul>
            </div>
          </form>
        </div>

        <!-- Tabla -->
        <div class="table-responsive">
          <table class="table table-bordered table-striped">
            <thead class="bg-light">
              <tr>
                <th>Call ID</th>
                <th>Agente</th>
                <th>Tipo de Llamada</th>
                <th>Género</th>
                <th>Identificación</th>
                <th>Nombre</th>
                <th>Campaña</th>
                <th>Tipo</th>
                <th>Motivo</th>
                <th>Submotivo</th>
                <th>observaciones</th>
                <th>Fecha Atención</th>
                <th>Hora Atención</th>
              </tr>
            </thead>
            <tbody>
              <% llamadas.forEach((llamada) => { %>
              <tr>
                <td><%= llamada.call_id %></td>
                <td><%= llamada.agent %></td>
                <td><%= llamada.tipo_llamada %></td>
                <td><%= llamada.genero %></td>
                <td><%= llamada.identificacion %></td>
                <td><%= llamada.nombre_apellidos %></td>
                <td><%= llamada.campana %></td>
                <td><%= llamada.tipo %></td>
                <td><%= llamada.motivo %></td>
                <td><%= llamada.submotivo %></td>
                <td><%= llamada.observaciones %></td>
                <td><%= llamada.fecha %></td>
                <td><%= llamada.hora %></td>
              </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const fechaDesde = document.getElementById("fechaDesde");
      const fechaHasta = document.getElementById("fechaHasta");
      function actualizarFechaHasta() {
        if (fechaDesde.value) {
          fechaHasta.removeAttribute("disabled");
          fechaHasta.setAttribute("min", fechaDesde.value);
        } else {
          fechaHasta.value = ""; 
          fechaHasta.setAttribute("disabled", "true");
        }
      }
      fechaDesde.addEventListener("change", actualizarFechaHasta);
      actualizarFechaHasta();
    });
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      if (window.location.search) {
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    });
  </script>
  
</html>
